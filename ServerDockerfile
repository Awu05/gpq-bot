FROM node:22-alpine AS builder

RUN apk update && apk upgrade && apk add git

WORKDIR /app

RUN git clone https://github.com/Awu05/gpq-bot.git .

RUN npm ci

RUN npm run build

FROM node:22-alpine AS runner

WORKDIR /app
ENV NODE_ENV=production

COPY --from=builder /app/package*.json ./
RUN npm ci --omit=dev && npm cache clean --force

COPY --from=builder /app/dist ./dist

CMD ["npm", "run", "start:prod"]